{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lista de Cuentas</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body
  class="font-sans text-[#333333] bg-[rgb(246,246,247)] bg-[url('/static/diseños/imagenes/14.jpg')] bg-cover m-0 p-[30px]">

  <!-- Header superior -->
  <div
    class="fixed top-0 left-0 w-full h-[100px] bg-[#4A4A4A] text-white z-[1001] flex items-center justify-center">
    <div class="relative flex items-center justify-center w-[90%]">
      <img src="{% static 'diseños/imagenes/logo.png' %}" alt="logo"
        class="absolute left-[-20px] h-[100px] w-auto" />
      <h4 class="m-0 text-[35px] font-bold text-center">
        Maderas <span class="text-[#ff9800]">Isabella</span>
      </h4>
    </div>
  </div>

  <!-- Contenedor principal con Sidebar y Contenido -->
  <div class="flex mt-[100px] ml-[250px] p-[20px] box-border">

    <!-- Menú vertical (Sidebar) -->
    <div
      class="fixed top-[100px] left-0 w-[250px] h-[calc(100vh-100px)] bg-[#4A4A4A] text-white p-[25px] box-border">
      <h2 class="text-[20px] mb-[20px] text-center">Menú</h2>
      <div class="flex flex-col">
        <a href="{% url 'index' %}"
           class="block p-[12px] mb-[10px] text-[#DBC5AD] no-underline rounded-[4px] transition-colors duration-300 ease hover:bg-[#45a049] hover:text-white">
          Inicio
        </a>
        <a href="{% url 'gestionar_productos' %}"
           class="block p-[12px] mb-[10px] text-[#DBC5AD] no-underline rounded-[4px] transition-colors duration-300 ease hover:bg-[#45a049] hover:text-white">
          Galería de Publicidad
        </a>
        <a href="{% url 'lista_login' %}"
           class="block p-[12px] mb-[10px] text-[#DBC5AD] no-underline rounded-[4px] transition-colors duration-300 ease hover:bg-[#45a049] hover:text-white">
          Listado de Cuentas
        </a>
        <a href="{% url 'carpeta' %}"
           class="block p-[12px] mb-[10px] text-[#DBC5AD] no-underline rounded-[4px] transition-colors duration-300 ease hover:bg-[#45a049] hover:text-white">
          Documentos de contratación
        </a>
        <a href="{% url 'manage_backups' %}"
           class="block p-[12px] mb-[10px] text-[#DBC5AD] no-underline rounded-[4px] transition-colors duration-300 ease hover:bg-[#45a049] hover:text-white">
          Gestión de BD (backups)
        </a>
        <a href="{% url 'logout' %}"
           class="block p-[12px] mb-[10px] text-[#DBC5AD] no-underline rounded-[4px] transition-colors duration-300 ease hover:bg-[#45a049] hover:text-white">
          Cerrar Sesión
        </a>
      </div>
    </div>

    <!-- Contenido principal -->
    <div class="flex-1 max-w-[1500px] bg-[rgba(255,255,255,0.77)] mx-auto p-[20px] rounded-[8px] shadow-[0_5px_15px_rgb(250,146,76),0_0_15px_5px_rgba(247,144,75,0.89)] box-border">
      <div class="text-center mb-[20px]">
        <h1 class="mb-[10px]">Lista de Cuentas Registradas</h1>
        <div class="buttons inline-flex">
          <button
            class="bg-[#cf9d67] text-white py-[10px] px-[20px] rounded-[5px] cursor-pointer transition-colors duration-300 ease hover:bg-[#45a049]"
            type="button" onclick="openCreateAccountModal()">
            Crear Cuenta
          </button>
          <a href="{% url 'index' %}" class="mx-[10px]">
            <button
              class="bg-[#cf9d67] text-white py-[10px] px-[20px] rounded-[5px] cursor-pointer transition-colors duration-300 ease hover:bg-[#45a049]"
              type="button">
              Regresa al inicio
            </button>
          </a>
        </div>
      </div>

      <div class="overflow-x-auto mt-[20px]">
        <table class="w-full border-collapse bg-white shadow-[0_0_10px_rgba(15,15,15,0.12)]">
          <thead class="bg-[#cf9d67] text-white">
            <tr>
              <th class="py-[12px] px-[15px] text-left">Nombres</th><th>|</th>
              <th class="py-[12px] px-[15px] text-left">Apellidos</th><th>|</th>
              <th class="py-[12px] px-[15px] text-left">Correo</th><th>|</th>
              <th class="py-[12px] px-[15px] text-left">Teléfono</th><th>|</th>
              <th class="py-[12px] px-[15px] text-left">Pregunta de Seguridad</th><th>|</th>
              <th class="py-[12px] px-[15px] text-left">Respuesta de Seguridad</th><th>|</th>
              <th class="py-[12px] px-[15px] text-left">Correo de Recuperación</th><th>|</th>
              <th class="py-[12px] px-[15px] text-left">Estado</th><th>|</th>
              <th class="py-[12px] px-[15px] text-left">Opciones</th>
            </tr>
          </thead>
          <tbody>
            {% for cuenta in cuentas %}
            <tr class="hover:bg-[rgba(146,143,143,0.6)]">
              <td class="py-[12px] px-[15px]">{{ cuenta.nombres }}</td><th>|</th>
              <td class="py-[12px] px-[15px]">{{ cuenta.apellidos }}</td><th>|</th>
              <td class="py-[12px] px-[15px]">{{ cuenta.email }}</td><th>|</th>
              <td class="py-[12px] px-[15px]">{{ cuenta.phone }}</td><th>|</th>
              <td class="py-[12px] px-[15px]">{{ cuenta.security_question }}</td><th>|</th>
              <td class="py-[12px] px-[15px]">{{ cuenta.security_answer }}</td><th>|</th>
              <td class="py-[12px] px-[15px]">{{ cuenta.recovery_email }}</td><th>|</th>
              <td class="py-[12px] px-[15px]">
                {{ cuenta.status }}
                {% if cuenta.status == 'Activo' %}
                  <a href="{% url 'desactivar_cuenta' cuenta.id %}" title="Desactivar" class="text-[#cf9d67] font-bold hover:underline">🔓</a>
                {% else %}
                  <a href="{% url 'activar_cuenta' cuenta.id %}" title="Activar" class="text-[#cf9d67] font-bold hover:underline">🔒</a>
                {% endif %}
              </td><th>|</th>
              <td class="py-[12px] px-[15px]">
                <button
                  class="bg-[#cf9d67] text-white py-[5px] px-[10px] rounded-[4px] cursor-pointer transition-colors duration-300 ease hover:bg-[#45a049]"
                  type="button"
                  onclick="openEditModal(
                    {{ cuenta.id }}, '{{ cuenta.email }}', '{{ cuenta.phone }}',
                    '{{ cuenta.security_question }}', '{{ cuenta.security_answer }}',
                    '{{ cuenta.recovery_email }}' )">
                  Editar
                </button>
                <button
                  class="bg-[#cf9d67] text-white py-[5px] px-[10px] rounded-[4px] cursor-pointer transition-colors duration-300 ease hover:bg-[#45a049] ml-[5px]"
                  type="button" onclick="openDeleteModal({{ cuenta.id }})">
                  Eliminar
                </button>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="15" class="py-[12px] px-[15px] text-center">No hay cuentas registradas.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal para confirmar eliminación -->
  <div id="deleteModal"
       class="hidden fixed top-0 left-0 w-screen h-screen bg-black bg-opacity-60 flex justify-center items-center z-[1000]">
    <div class="bg-white p-[2rem] rounded-[8px] max-w-[500px] w-full text-center">
      <span class="absolute right-[10px] top-[10px] text-[20px] cursor-pointer" onclick="closeDeleteModal()">&times;</span>
      <h3>¿Estás seguro de eliminar esta cuenta?</h3>
      <div class="mt-[20px]">
        <button
          class="bg-[#cf9d67] text-white py-[5px] px-[10px] rounded-[4px] mr-[10px] hover:bg-[#45a049] transition-colors duration-300 ease"
          onclick="confirmDelete()">
          Sí, eliminar
        </button>
        <button
          class="bg-gray-300 text-gray-800 py-[5px] px-[10px] rounded-[4px] hover:bg-gray-400 transition-colors duration-300 ease"
          onclick="closeDeleteModal()">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de edición -->
  <div id="editModal"
       class="hidden fixed top-0 left-0 w-screen h-screen bg-black bg-opacity-60 flex justify-center items-center z-[9999]">
    <div class="relative bg-white p-[2rem] rounded-[8px] max-w-[500px] w-[90%] shadow-[0_0_15px_rgba(0,0,0,0.3)] max-h-[90%] overflow-y-auto">
      <span class="absolute right-[10px] top-[10px] text-[20px] cursor-pointer" onclick="closeEditModal()">&times;</span>
      {% include 'libros/editar_cuenta_form.html' %}
    </div>
  </div>

  <!-- Modal de creación -->
  {% include 'libros/registro_form.html' %}

  <script src="{% static 'js/lista_login.js' %}?v={{ timestamp }}"></script>
</body>
</html>
